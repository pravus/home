#!/usr/bin/env python

import argparse
import requests

class App:

  def __init__(self):
    parser = argparse.ArgumentParser()
    parser.add_argument('-a', '--audio-only', action='store_true',
      help='save only the audio stream')
    parser.add_argument('-u', '--url', default='http://abyss.nil:4151/pub?topic=mu-exec.youtube-dl',
      help='specify the url for posting requests')
    parser.add_argument('urls', nargs='+', metavar='URL',
      help='urls to download')

    self.args = parser.parse_args()

  def main(self):
    for url in self.args.urls:
      self.post(url)

  def post(self, url):
    req = {
      'url':        url,
      'audio_only': self.args.audio_only,
    }
    res = requests.post(self.args.url, json=req)
    if res.status_code != 200:
      print('post: error: {} {}'.format(res.status_code, res.text))
      return False
    return True


if __name__ == '__main__':
  App().main()
